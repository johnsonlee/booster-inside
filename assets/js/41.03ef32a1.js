(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{351:function(t,s,a){"use strict";a.r(s);var n=a(33),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"移除冗余资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#移除冗余资源"}},[t._v("#")]),t._v(" 移除冗余资源")]),t._v(" "),a("h2",{attrs:{id:"资源限定符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#资源限定符"}},[t._v("#")]),t._v(" 资源限定符")]),t._v(" "),a("p",[a("em",[t._v("Android")]),t._v(" 为了便于对特定设备进行适配，定义了一系列资源配置限定符（Configuration Qualifier），开发者只需要根据限定符来对资源进行命名，"),a("em",[t._v("Android Framework")]),t._v(" 会根据上下文环境完成适配工作，常用的 "),a("em",[t._v("Configuration")]),t._v(" 有：")]),t._v(" "),a("ol",[a("li",[t._v("语言和区域")]),t._v(" "),a("li",[t._v("幕尺寸")])]),t._v(" "),a("ul",[a("li",[t._v("small")]),t._v(" "),a("li",[t._v("normal")]),t._v(" "),a("li",[t._v("large")]),t._v(" "),a("li",[t._v("xlarge")])]),t._v(" "),a("ol",[a("li",[t._v("屏幕方向")])]),t._v(" "),a("ul",[a("li",[t._v("port")]),t._v(" "),a("li",[t._v("land")])]),t._v(" "),a("ol",[a("li",[t._v("屏幕像素密度")])]),t._v(" "),a("ul",[a("li",[t._v("ldpi")]),t._v(" "),a("li",[t._v("mdpi")]),t._v(" "),a("li",[t._v("hdpi")]),t._v(" "),a("li",[t._v("xhdpi")]),t._v(" "),a("li",[t._v("xxhdpi")]),t._v(" "),a("li",[t._v("xxxhdpi")]),t._v(" "),a("li",[t._v("nodpi")]),t._v(" "),a("li",[t._v("tvdpi")]),t._v(" "),a("li",[t._v("anydpi")]),t._v(" "),a("li",[a("em",[t._v("nnn")]),t._v("dpi")])]),t._v(" "),a("ol",[a("li",[t._v("平台版本（API Level）")])]),t._v(" "),a("ul",[a("li",[t._v("v3")]),t._v(" "),a("li",[t._v("v4")]),t._v(" "),a("li",[t._v("v7")]),t._v(" "),a("li",[t._v("...")])]),t._v(" "),a("h2",{attrs:{id:"移除不必要的资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#移除不必要的资源"}},[t._v("#")]),t._v(" 移除不必要的资源")]),t._v(" "),a("p",[t._v("对于只发布在国内应用市场的 "),a("em",[t._v("APP")]),t._v(" 来说，有些不是完全需要的，如：多语言、多屏幕密度等，我们可以在 "),a("em",[t._v("build.gradle")]),t._v(" 中通过如下配置来移除不必要的资源：")]),t._v(" "),a("div",{staticClass:"language-groovy extra-class"},[a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[t._v("android "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    defaultConfig "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        resConfigs "),a("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"zh"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("另一种方式是针对不同的 "),a("em",[t._v("Configuration")]),t._v(" 分别构建 "),a("em",[t._v("APK")]),t._v("，例如，根据屏幕密度来为每种屏幕密度构建一个独立 "),a("em",[t._v("APK")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-groovy extra-class"},[a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[t._v("android "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    splits "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        density "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            enable "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n            exclude "),a("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"ldpi"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"xxhdpi"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"xxxhdpi"')]),t._v("\n            compatibleScreens "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'small'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'normal'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'large'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xlarge'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("既然移除冗余资源这么简单，那还要 "),a("em",[t._v("Booster")]),t._v(" 做什么？")]),t._v(" "),a("h2",{attrs:{id:"国内的现状"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#国内的现状"}},[t._v("#")]),t._v(" 国内的现状")]),t._v(" "),a("p",[t._v("国内的大多数 "),a("em",[t._v("APP")]),t._v(" 对于不同的屏幕密度适配做得不是很完善，可能有的只适配了 "),a("code",[t._v("xhdpi")]),t._v("，有的适配了 "),a("code",[t._v("xhdpi")]),t._v(" 和 "),a("code",[t._v("xxhdpi")]),t._v("，总之不是所有的图片资源适配的密度是一致的，如果用上面的「拆分 APK」的方式来构建的话，就会出现有些资源找不到的情况，为了解决这一问题，"),a("em",[t._v("Booster")]),t._v(" 采用了另一种去冗余的方式：")]),t._v(" "),a("ol",[a("li",[t._v("先按资源类型分组；")]),t._v(" "),a("li",[t._v("同类型资源按名称分组；")]),t._v(" "),a("li",[t._v("同名称资源按 "),a("em",[t._v("density")]),t._v(" 从高到底排序")]),t._v(" "),a("li",[t._v("针对同类型、同名称的不同 "),a("em",[t._v("denisty")]),t._v(" 资源，保留最高 "),a("em",[t._v("density")]),t._v(" 的资源，移除其它 "),a("em",[t._v("density")]),t._v(" 资源")])]),t._v(" "),a("p",[t._v("上面的过程看起来很简单，但是，实际情况要比这更复杂，有没有可能存在同类型、同名称、同 "),a("em",[t._v("density")]),t._v(" 的资源呢？当然是可能的，毕竟 "),a("em",[t._v("Configuration")]),t._v(" 有很多个适配维度，比如：屏幕布局方向（"),a("a",{attrs:{href:"https://github.com/didi/booster/blob/master/booster-aapt2/src/main/kotlin/com/didiglobal/booster/aapt/Configuration.kt#L415",target:"_blank",rel:"noopener noreferrer"}},[t._v("ScreenConfig.layout"),a("OutboundLink")],1),t._v(")。")]),t._v(" "),a("h2",{attrs:{id:"支持-rtl-布局方向"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#支持-rtl-布局方向"}},[t._v("#")]),t._v(" 支持 RTL 布局方向")]),t._v(" "),a("p",[t._v("大多数国家或地区的语言采用的是从左到右（Left-To-Right）的布局方向，像阿拉伯语采用的是从右到左（Right-To-Left）的布局方向，在 "),a("em",[t._v("Android 4.1.1 (API Level 16)")]),t._v(" 及以下版本是忽略了 "),a("em",[t._v("android:supportsRtl")]),t._v(" 属性的，而从 "),a("em",[t._v("API Level 17")]),t._v(" 开始，可以在 "),a("em",[t._v("AndroidManifest.xml")]),t._v(" 中设置 "),a("em",[t._v("android:supportsRtl")]),t._v(" 属性：")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("manifest")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("...")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    ...\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("application")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("...")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("supportsRtl")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("manifest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("因此，在去冗余资源的时候，还需要根据 "),a("em",[t._v("supportsRtl")]),t._v(" 属性来决定是否保留同 "),a("em",[t._v("density")]),t._v(" 但不同布局方向的资源。")]),t._v(" "),a("h2",{attrs:{id:"如何使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何使用"}},[t._v("#")]),t._v(" 如何使用")]),t._v(" "),a("p",[t._v("开启去冗余资源只需要引入 "),a("a",{attrs:{href:"https://github.com/didi/booster/blob/master/booster-task-resource-deredundancy",target:"_blank",rel:"noopener noreferrer"}},[t._v("booster-task-resource-deredundancy"),a("OutboundLink")],1),t._v(" 即可，如下所示：")]),t._v(" "),a("div",{staticClass:"language-groovy extra-class"},[a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[t._v("buildscript "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ext "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        kotlin_version "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1.3.31'")]),t._v("\n        booster_version "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1.0'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    repositories "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mavenLocal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mavenCentral")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("google")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("jcenter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        maven "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://oss.sonatype.org/content/repositories/public/'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        maven "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://oss.sonatype.org/content/repositories/snapshots/'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    dependencies "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        classpath "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'com.android.tools.build:gradle:3.5.0'")]),t._v("\n        classpath "),a("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"org.jetbrains.kotlin:kotlin-gradle-plugin:'),a("span",{pre:!0,attrs:{class:"token expression"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),t._v("kotlin_version")]),t._v('"')]),t._v("\n        classpath "),a("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"com.didiglobal.booster:booster-gradle-plugin:'),a("span",{pre:!0,attrs:{class:"token expression"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),t._v("booster_version")]),t._v('"')]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 👇👇👇👇 引用这个模块 👇👇👇👇 */")]),t._v("\n        classpath "),a("span",{pre:!0,attrs:{class:"token string gstring"}},[t._v('"com.didiglobal.booster:booster-task-resource-deredundancy:'),a("span",{pre:!0,attrs:{class:"token expression"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),t._v("booster_version")]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[a("em",[t._v("Android Gradle Plugin 3.6")]),t._v(" 及以上版本，需要在 "),a("em",[t._v("gradle.properties")]),t._v(" 中设置：")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("android.precompileDependenciesResources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("false")]),t._v("\n")])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);